FROM oven/bun:latest

ENV NODE_ENV=production

WORKDIR /app

# Copy only the necessary files for migrations
COPY package.json bun.lockb ./
COPY drizzle.config.ts ./
COPY src/db ./src/db
COPY drizzle ./drizzle

RUN bun install

RUN echo "Database URL:" ${DATABASE_URL}
RUN echo "Database URL External:" ${DATABASE_URL_EXTERNAL}

CMD ["bunx", "drizzle-kit", "migrate"] 
